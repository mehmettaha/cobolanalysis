COBOL 分析ツール

COBOL分析ツールは、COBOLのプログラムとジョブを.txtファイルを入力すればプログラム、ジョブ、コール、コピー等の関係図を自動に作成するツールです。

ツールの内容
本ツールは、3つのプログラムに分かれています：
Choose dialog.py: COBOLのプログラムとジョブファイルを受け取り、グラフに使うエクセルを作成します。
Analysis dialog.py: Cobol file analysis.pyでできたエクセルを受け取り、様々なグラフ化機能を行います。
Edit dialog.py: Analysis dialog.pyでできたグラフを、一から再作成せず変更することに使います。

実行方法
.pyファイルをダウンロードします。
Anacondaコマンドプロンプトで「cd (.pyのパス)」コマンドでそのpyのパスに行きます。
「python "choose dialog.py"」コマンドでプログラムを実行します。

使い方
実行する前に
本ツールはPython3で作成され、実行するに必要なライブラリがあります。
Anaconda: https://www.anaconda.com/distribution/
Anacondaを導入し、Anacondaの中で下記のライブラリを導入してください。
依存ライブラリリスト：
Pandas
Graphviz
Tkinter
Edit dialogのみ必要するライブラリ：
Pygraphviz
Microsoft Visual C++ Build tool v.14.00(Anacondaではできません)

また、graphvizを別途導入する必要があります：https://www.graphviz.org/download/

1.	Choose dialog.py
まず、COBOLのプログラムとジョブを別々のフォルダに分かれ、パスを確認してください。

次に、”Choose dialog.py”を実行します。
 
上図の画面でプログラムのフォルダとジョブのフォルダを選びます。（順不問）
Choose pathボタンを押すとまず分析機能が実行されます。分析に問題がなければ、保存のパスを指定するダイアログが表れます。
 
「フォルダーの選択」ボタンを押すと分析の結果ファイルは下図のように保存されます。


 

2.	Analysis dialog.py
 
クラスタの有無を決め、希望のエンジン（図のフォーマット）を選び、Choose fileブタンを押すと、下図のダイアログが表示されます。


 
前のステップでできたCobol analysis.xlsのパスに移動し、ファイルを選んで「開く」を押すと、ファイルが読み込まれ、グラフのソースコードがプログラム内で作成されます。
 
a. View Graphボタンを押すと全体図が表示されます。
b. View Class Diagramではインスタンスが省略され、クラス間の関係図が作成されます。
c. Focus on two classesボタンを押すと以下のダイアログが表れます：
 
この機能では二つのクラスに集中し、間のクラスを省略することができます。たとえば：
 
上図のクラスダイアグラムでJobFileとCopiedFilesに直接の関係はないようですが、JobID-ProgramFile-ProgramIDの関係で間接的にかかわります。この場合に、
Class 1 :JobFile
Class2: CopiedFiles
を入力し、任意のエンジンを選ぶと、JobFileのどのインスタンスが、間接的にCopiedFilesのどのインスタンスに関わるかを確認できます。
 


d. Save graph and sourceは、グラフを保存するボタンです。押すと下図のダイアログが表れます。
 
グラフ名を入力し、保存ボタンを押すと、「グラフ名」.svgのグラフファイルと、「グラフ名-source」.txtのソースコードが保存されます。

e. Focus on a single instanceボタンを押すと下図のダイアログが表れます。
 
テキストボックスに任意のインスタンス名を入力し、希望のエンジンを選び、Searchボタンを押してください。入力したインスタンスに関わるインスタンスのみ表示されるグラフが表れます。
 

3.	Edit dialog.py
本プログラムでは、リアルタイムでグラフを編集すること、各インスタンス、関係を詳細にカスタマイズすることができます。
端末と環境によって、ダブルクリックで実行すると失敗する場合がありますので、その場合は下記の方法で実行してみてください。
1.	Win + S ボタンを押します。
2.	Anacondaを入力するとAnaconda Promptが表れます。実行してください。
3.	python “「Edit dialog.pyのパス」”を入力し、Enterを押してください。
 
プログラムを実行できると、下図のダイアログが表れます。
 
ボタンを押し、グラフのソースコードが入っている.txtファイルを選んでください。
注：.svgを直接編集することはできません。.svgファイルの元のソースコードが必要です。

次に下図のダイアログが表れます。

 

まず、上の3つのボタンの中から検索する物を選び、検索の項目を入力してください。エッジボタンを押すとテキストボックスはもう一つ表れます。
例：node:DOCOMOM80-S, edge: DOCOMOM80-S, KIN85REM等

Searchボタンを押すと、検索した項目に関する属性が表示されます。
ノード：
 
エッジ：
 

サブグラフ：
 
graphボタンを押すとグラフ全体を編集するダイアログが表れます。

グラフ
 
こちらでノード、エッジ、サブグラフを任意に編集できます。入力可能な値を調べるにはこちらにご参照ください：https://www.graphviz.org/doc/info/attrs.html
編集が終わったらSaveボタンを押し、入力済値を保存します。Quitボタンでダイアログを閉じます。
注：こちらのSaveボタンは仮なセーブで、ソースコードを上書きしません。


メインのダイアログでいくらでも検索・編集できます。希望のエンジンを選びView without savingボタンを押すと当時のグラフを拝見できます。

編集が終わってグラフを保存したい場合は、Save as SVGボタンを押します。
 

パスを指定し、グラフ名を入力すると、Analysis dialogと同様に「グラフ名」.svgと[グラフ名-source].txtが保存されます。
